# This must come first in this particular file.
from flask import Flask
app = Flask(__name__)

# Import all of the controllers for your application
from application.controllers import *
from config import config

# For stress testing
#import application.stress

# from application.models import theDB

# This hook ensures that a connection is opened to handle any queries
# generated by the request.
@app.before_request
def _db_connect():
  for db in config.databases:
    theDB = config.databases[db].theDB
    theDB.connect()

# This hook ensures that the connection is closed when we've finished
# processing the request.
@app.teardown_appcontext
def _db_close(exc):
  for db in config.databases:
    theDB = config.databases[db].theDB
    if not theDB.is_closed():
        theDB.close()
